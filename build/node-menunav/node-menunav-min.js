YUI.add("node-menunav",function(s,e){var c=s.UA,r=s.later,i=s.ClassNameManager.getClassName,a="menu",_="menuitem",l="parentNode",n="children",o="offsetHeight",m="offsetWidth",h="id",v=".",d="handledMouseOut",M="handledMouseOver",t="active",u="label",f="a",g="mousedown",b="keydown",p="click",S="role",I="presentation",T="descendants",A="activeDescendant",w="useARIA",y="aria-hidden",D="content",C="host",k=A+"Change",O="autoSubmenuDisplay",H="mouseOutHideDelay",F=i(a),x=i(a,"hidden"),E=i(a,"horizontal"),R=i(a,u),L=i(a,u,t),N=i(a,u,a+"visible"),P=i(_),K=i(_,t),X=v+F,z=v+i(a,"toggle"),U=v+i(a,D),t=v+R,V=">"+U+">ul>li>a",Y=">"+U+">ul>li>"+t+">a:first-child",j=function(e){return e.previous()||(e=e.get(l).get(n)).item(e.size()-1)},q=function(e){return e.next()||e.get(l).get(n).item(0)},B=function(e){var n=!1;return n=e?e.get("nodeName").toLowerCase()===f:n},W=function(e){return e.hasClass(P)},G=function(e){return e.hasClass(R)},J=function(e){return e.hasClass(E)},Q=function(e){return e.hasClass(N)},Z=function(e){return B(e)?e:e.one(f)},$=function(e,n,t){var u;return u=e&&!(u=e.hasClass(n)?e:u)&&t?e.ancestor(v+n):u},ee=function(e){return e.ancestor(X)},ne=function(e,n){return $(e,F,n)},te=function(e,n){var t;return t=e?$(e,P,n):t},ue=function(e,n){var t;return t=e?n?$(e,R,n):$(e,R)||e.one(v+R):t},oe=function(e,n){var t;return t=e?te(e,n)||ue(e,n):t},ie=function(e){return oe(e.one("li"))},se=function(e){return W(e)?K:L},ae=function(e,n){return e&&!e[M]&&(e.compareTo(n)||e.contains(n))},ce=function(e,n){return e&&!e[d]&&!e.compareTo(n)&&!e.contains(n)},re=function(){re.superclass.constructor.apply(this,arguments)};re.NAME="nodeMenuNav",re.NS="menuNav",re.SHIM_TEMPLATE_TITLE="Menu Stacking Shim",re.SHIM_TEMPLATE='<iframe frameborder="0" tabindex="-1" class="'+i("shim")+'" title="'+re.SHIM_TEMPLATE_TITLE+'" src="javascript:false;"></iframe>',re.ATTRS={useARIA:{value:!0,writeOnce:!0,lazyAdd:!1,setter:function(e){var n,t,u,o=this.get(C);e&&(o.set(S,a),o.all("ul,li,"+U).set(S,I),o.all(v+i(_,D)).set(S,_),o.all(v+R).each(function(e){(u=(n=e).one(z))&&(u.set(S,I),n=u.previous()),n.set(S,_),n.set("aria-haspopup",!0),(t=e.next())&&(t.set(S,a),n=t.previous(),(u=n.one(z))&&(n=u),u=s.stamp(n),n.get(h)||n.set(h,u),t.set("aria-labelledby",u),t.set(y,!0))}))}},autoSubmenuDisplay:{value:!0,writeOnce:!0},submenuShowDelay:{value:250,writeOnce:!0},submenuHideDelay:{value:250,writeOnce:!0},mouseOutHideDelay:{value:750,writeOnce:!0}},s.extend(re,s.Plugin.Base,{_rootMenu:null,_activeItem:null,_activeMenu:null,_hasFocus:!1,_blockMouseEvent:!1,_currentMouseX:0,_movingToSubmenu:!1,_showSubmenuTimer:null,_hideSubmenuTimer:null,_hideAllSubmenusTimer:null,_firstItem:null,initializer:function(e){var n=this,t=this.get(C),u=[];t&&((n._rootMenu=t).all("ul:first-child").addClass("first-of-type"),t.all(X).addClass(x),u.push(t.on("mouseover",n._onMouseOver,n)),u.push(t.on("mouseout",n._onMouseOut,n)),u.push(t.on("mousemove",n._onMouseMove,n)),u.push(t.on(g,n._toggleSubmenuDisplay,n)),u.push(s.on("key",n._toggleSubmenuDisplay,t,"down:13",n)),u.push(t.on(p,n._toggleSubmenuDisplay,n)),u.push(t.on("keypress",n._onKeyPress,n)),u.push(t.on(b,n._onKeyDown,n)),t=t.get("ownerDocument"),u.push(t.on(g,n._onDocMouseDown,n)),u.push(t.on("focus",n._onDocFocus,n)),this._eventHandlers=u,n._initFocusManager())},destructor:function(){var e=this._eventHandlers;e&&(s.Array.each(e,function(e){e.detach()}),this._eventHandlers=null),this.get(C).unplug("focusManager")},_isRoot:function(e){return this._rootMenu.compareTo(e)},_getTopmostSubmenu:function(e){var n=ee(e),n=!n||this._isRoot(n)?e:this._getTopmostSubmenu(n);return n},_clearActiveItem:function(){var e=this._activeItem;e&&e.removeClass(se(e)),this._activeItem=null},_setActiveItem:function(e){e&&(this._clearActiveItem(),e.addClass(se(e)),this._activeItem=e)},_focusItem:function(e){var n,t=this;e&&t._hasFocus&&(n=ee(e),e=Z(e),n&&!n.compareTo(t._activeMenu)&&(t._activeMenu=n,t._initFocusManager()),t._focusManager.focus(e))},_showMenu:function(e){var n=ee(e),t=e.get(l),u=t.getXY();this.get(w)&&e.set(y,!1),J(n)?u[1]=u[1]+t.get(o):u[0]=u[0]+t.get(m),e.setXY(u),c.ie&&c.ie<8&&(6!==c.ie||e.hasIFrameShim||(e.appendChild(s.Node.create(re.SHIM_TEMPLATE)),e.hasIFrameShim=!0),e.setStyles({height:"",width:""}),e.setStyles({height:e.get(o)+"px",width:e.get(m)+"px"})),e.previous().addClass(N),e.removeClass(x)},_hideMenu:function(e,n){var t=e.previous();t.removeClass(N),n&&(this._focusItem(t),this._setActiveItem(t)),(t=e.one(v+K))&&t.removeClass(K),e.setStyles({left:"",top:""}),e.addClass(x),this.get(w)&&e.set(y,!0)},_hideAllSubmenus:function(e){var n=this;e.all(X).each(s.bind(function(e){n._hideMenu(e)},n))},_cancelShowSubmenuTimer:function(){var e=this._showSubmenuTimer;e&&(e.cancel(),this._showSubmenuTimer=null)},_cancelHideSubmenuTimer:function(){var e=this._hideSubmenuTimer;e&&(e.cancel(),this._hideSubmenuTimer=null)},_initFocusManager:function(){var e,n=this,t=n._rootMenu,u=n._activeMenu||t,o=n._isRoot(u)?"":"#"+u.get("id"),i=n._focusManager,o=J(u)?(e=o+V+","+o+Y,{next:"down:39",previous:"down:37"}):(e=o+V,{next:"down:40",previous:"down:38"});i?(i.set(A,-1),i.set(T,e),i.set("keys",o)):(t.plug(s.Plugin.NodeFocusManager,{descendants:e,keys:o,circular:!0}),i=t.focusManager,o="#"+t.get("id")+X+" a,"+z,t.all(o).set("tabIndex",-1),i.on(k,this._onActiveDescendantChange,i,this),i.after(k,this._afterActiveDescendantChange,i,this),n._focusManager=i)},_onActiveDescendantChange:function(e,n){"UI"===e.src&&n._activeMenu&&!n._movingToSubmenu&&n._hideAllSubmenus(n._activeMenu)},_afterActiveDescendantChange:function(e,n){"UI"===e.src&&(e=oe(this.get(T).item(e.newVal),!0),n._setActiveItem(e))},_onDocFocus:function(e){var n=this,t=(n._activeItem,e.target);n._rootMenu.contains(t)?n._hasFocus?(e=ee(t),n._activeMenu.compareTo(e)||(n._activeMenu=e,n._initFocusManager(),n._focusManager.set(A,t),n._setActiveItem(oe(t,!0)))):(n._hasFocus=!0,(t=oe(t,!0))&&n._setActiveItem(t)):(n._clearActiveItem(),n._cancelShowSubmenuTimer(),
n._hideAllSubmenus(n._rootMenu),n._activeMenu=n._rootMenu,n._initFocusManager(),n._focusManager.set(A,0),n._hasFocus=!1)},_onMenuMouseOver:function(e,n){var t=this,u=t._hideAllSubmenusTimer;u&&(u.cancel(),t._hideAllSubmenusTimer=null),t._cancelHideSubmenuTimer(),e&&!e.compareTo(t._activeMenu)&&(t._activeMenu=e,t._hasFocus&&t._initFocusManager()),t._movingToSubmenu&&J(e)&&(t._movingToSubmenu=!1)},_hideAndFocusLabel:function(){var e=this,n=e._activeMenu;e._hideAllSubmenus(e._rootMenu),n&&(n=e._getTopmostSubmenu(n),e._focusItem(n.previous()))},_onMenuMouseOut:function(e,n){var t=this,u=t._activeMenu,o=n.relatedTarget,n=t._activeItem;u&&!u.contains(o)&&((u=ee(u))&&!u.contains(o)?0<t.get(H)&&(t._cancelShowSubmenuTimer(),t._hideAllSubmenusTimer=r(t.get(H),t,t._hideAndFocusLabel)):n&&(n=ee(n),t._isRoot(n)||t._focusItem(n.previous())))},_onMenuLabelMouseOver:function(n,e){var t,u=this,o=u._activeMenu,i=u._isRoot(o),s=u.get(O)&&i||!i,i=u.get("submenuShowDelay"),a=function(e){u._cancelHideSubmenuTimer(),u._cancelShowSubmenuTimer(),Q(n)||(t=n.next())&&(u._hideAllSubmenus(o),u._showSubmenuTimer=r(e,u,u._showMenu,t))};u._focusItem(n),u._setActiveItem(n),s&&(u._movingToSubmenu?u._hoverTimer=r(i,u,function(){a(0)}):a(i))},_onMenuLabelMouseOut:function(e,n){var t=this,u=t._isRoot(t._activeMenu),o=t.get(O)&&u||!u,u=n.relatedTarget,n=e.next(),e=t._hoverTimer;e&&e.cancel(),t._clearActiveItem(),o&&(t._movingToSubmenu&&!t._showSubmenuTimer&&n?t._hideSubmenuTimer=r(t.get("submenuHideDelay"),t,t._hideMenu,n):t._movingToSubmenu||!n||u&&(n.contains(u)||u.compareTo(n))||(t._cancelShowSubmenuTimer(),t._hideMenu(n)))},_onMenuItemMouseOver:function(e,n){var t=this,u=t._activeMenu,o=t._isRoot(u),o=t.get(O)&&o||!o;t._focusItem(e),t._setActiveItem(e),o&&!t._movingToSubmenu&&t._hideAllSubmenus(u)},_onMenuItemMouseOut:function(e,n){this._clearActiveItem()},_onVerticalMenuKeyDown:function(e){var n,t,u,o,i=this,s=i._activeMenu,a=i._rootMenu,c=e.target,r=!1;switch(e.keyCode){case 37:(t=ee(s))&&J(t)?(i._hideMenu(s),u=j(s.get(l)),(o=oe(u))&&(G(o)&&(n=o.next())?(i._showMenu(n),i._focusItem(ie(n)),i._setActiveItem(ie(n))):(i._focusItem(o),i._setActiveItem(o)))):i._isRoot(s)||i._hideMenu(s,!0),r=!0;break;case 39:G(c)?(n=c.next())&&(i._showMenu(n),i._focusItem(ie(n)),i._setActiveItem(ie(n))):J(a)&&(n=i._getTopmostSubmenu(s),u=q(n.get(l)),o=oe(u),i._hideAllSubmenus(a),o&&(G(o)&&(n=o.next())?(i._showMenu(n),i._focusItem(ie(n)),i._setActiveItem(ie(n))):(i._focusItem(o),i._setActiveItem(o)))),r=!0}r&&e.preventDefault()},_onHorizontalMenuKeyDown:function(e){var n=this,t=n._activeMenu,u=e.target,o=oe(u,!0),u=!1;40===e.keyCode&&(n._hideAllSubmenus(t),G(o)&&((o=o.next())&&(n._showMenu(o),n._focusItem(ie(o)),n._setActiveItem(ie(o))),u=!0)),u&&e.preventDefault()},_onMouseMove:function(e){var n=this;r(10,n,function(){n._currentMouseX=e.pageX})},_onMouseOver:function(e){var n,t,u,o,i=this;i._blockMouseEvent?i._blockMouseEvent=!1:(n=e.target,u=ne(n,!0),t=ue(n,!0),o=te(n,!0),ae(u,n)&&(i._onMenuMouseOver(u,e),u[M]=!0,u[d]=!1,(u=ee(u))&&(u[d]=!0,u[M]=!1)),ae(t,n)&&(i._onMenuLabelMouseOver(t,e),t[M]=!0,t[d]=!1),ae(o,n)&&(i._onMenuItemMouseOver(o,e),o[M]=!0,o[d]=!1))},_onMouseOut:function(e){var n,t,u,o,i=this,s=i._activeMenu,a=!1;i._movingToSubmenu=s&&!J(s)&&e.pageX-5>i._currentMouseX,o=e.target,n=e.relatedTarget,t=ne(o,!0),s=ue(o,!0),o=te(o,!0),ce(s,n)&&(i._onMenuLabelMouseOut(s,e),s[d]=!0,s[M]=!1),ce(o,n)&&(i._onMenuItemMouseOut(o,e),o[d]=!0,o[M]=!1),s&&(u=s.next())&&n&&(n.compareTo(u)||u.contains(n))&&(a=!0),(ce(t,n)||a)&&(i._onMenuMouseOut(t,e),t[d]=!0,t[M]=!1)},_toggleSubmenuDisplay:function(e){var n,t,u,o=this,i=e.target,s=ue(i,!0),a=e.type;s&&(u=B(i)?i:i.ancestor(B))&&(t=(n=u.getAttribute("href",2)).indexOf("#"),u=n.length,0===t&&1<u&&(u=n.substr(1,u),(n=s.next())&&n.get(h)===u&&(a!==g&&a!==b||((c.opera||c.gecko||c.ie)&&a===b&&!o._preventClickHandle&&(o._preventClickHandle=o._rootMenu.on("click",function(e){e.preventDefault(),o._preventClickHandle.detach(),o._preventClickHandle=null})),a==g&&(e.preventDefault(),e.stopImmediatePropagation(),o._hasFocus=!0),o._isRoot(ee(i))?Q(s)?(o._hideMenu(n),o._focusItem(s),o._setActiveItem(s)):(o._hideAllSubmenus(o._rootMenu),o._showMenu(n),o._focusItem(ie(n)),o._setActiveItem(ie(n))):o._activeItem==s?(o._showMenu(n),o._focusItem(ie(n)),o._setActiveItem(ie(n))):s._clickHandle||(s._clickHandle=s.on("click",function(){o._hideAllSubmenus(o._rootMenu),o._hasFocus=!1,o._clearActiveItem(),s._clickHandle.detach(),s._clickHandle=null}))),a===p&&e.preventDefault())))},_onKeyPress:function(e){switch(e.keyCode){case 37:case 38:case 39:case 40:e.preventDefault()}},_onKeyDown:function(e){var n=this,t=n._activeItem,u=e.target,o=ee(u);o&&(n._activeMenu=o,J(o)?n._onHorizontalMenuKeyDown(e):n._onVerticalMenuKeyDown(e),27===e.keyCode&&(n._isRoot(o)?t&&(G(t)&&Q(t)?(t=t.next())&&n._hideMenu(t):(n._focusManager.blur(),n._clearActiveItem(),n._hasFocus=!1)):(c.opera?r(0,n,function(){n._hideMenu(o,!0)}):n._hideMenu(o,!0),e.stopPropagation(),n._blockMouseEvent=!!c.gecko)))},_onDocMouseDown:function(e){var n=this._rootMenu,e=e.target;n.compareTo(e)||n.contains(e)||(this._hideAllSubmenus(n),c.webkit&&(this._hasFocus=!1,this._clearActiveItem()))}}),s.namespace("Plugin"),s.Plugin.NodeMenuNav=re},"@VERSION@",{requires:["node","classnamemanager","plugin","node-focusmanager"],skinnable:!0});
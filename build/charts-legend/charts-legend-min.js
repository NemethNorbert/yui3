YUI.add("charts-legend",function(z,t){var y="top",p="right",_="bottom",w="left",o="horizontal",b="width",m="height",d="position",S="x",v="y",N="px",e={setter:function(t){var e=this.get("legend");return e&&e.destroy(!0),t instanceof z.ChartLegend?(e=t).set("chart",this):(t.chart=this,t.hasOwnProperty("render")||(t.render=this.get("contentBox"),t.includeInChartLayout=!0),e=new z.ChartLegend(t)),e}},B={_positionLegendItems:function(t,e,i,h,s,r,a,n,o){var g,l,d,c,f,u,y,p,_,w,b,m,S,v,C=0,L=0,x=this.get("width"),k=r.top-n,A=x-(r.left+r.right);for(B._setRowArrays(t,A,a),u=B.rowArray,_=B.totalWidthArray,y=u.length;L<y;++L){for(k+=n,f=(p=u[L]).length,w=B.getStartPoint(x,_[L],o,r),C=0;C<f;++C)l=(g=p[C]).node,d=g.width,c=g.height,g.x=w,g.y=0,b=isNaN(b)?w:Math.min(b,w),m=isNaN(m)?k:Math.min(m,k),S=isNaN(S)?w+d:Math.max(w+d,S),v=isNaN(v)?k+c:Math.max(k+c,v),l.setStyle("left",w+N),l.setStyle("top",k+N),w+=d+a;k+=g.height}this._contentRect={left:b,top:m,right:S,bottom:v},this.get("includeInChartLayout")&&this.set("height",k+r.bottom)},_setRowArrays:function(t,e,i){for(var h,s=t[0],r=[[s]],a=1,n=0,o=t.length,g=s.width,l=[[g]];a<o;++a)g+i+(h=(s=t[a]).width)<=e?(g+=i+h,r[n].push(s)):(g=i+h,r[n]&&(n+=1),r[n]=[s]),l[n]=g;B.rowArray=r,B.totalWidthArray=l},getStartPoint:function(t,e,i,h){var s;switch(i){case w:s=h.left;break;case"center":s=.5*(t-e);break;case p:s=t-e-h.right}return s}},I={_positionLegendItems:function(t,e,i,h,s,r,a,n,o){var g,l,d,c,f,u,y,p,_,w,b,m,S,v,C,L=0,x=0,k=this.get("height"),A=r.left-a,B=k-(r.top+r.bottom);for(I._setColumnArrays(t,B,n),u=I.columnArray,_=I.totalHeightArray,y=u.length;x<y;++x){for(A+=a,f=(p=u[x]).length,w=I.getStartPoint(k,_[x],o,r),L=b=0;L<f;++L)l=(g=p[L]).node,d=g.height,c=g.width,g.y=w,g.x=A,m=isNaN(m)?A:Math.min(m,A),S=isNaN(S)?w:Math.min(S,w),v=isNaN(v)?A+c:Math.max(A+c,v),C=isNaN(C)?w+d:Math.max(w+d,C),l.setStyle("left",A+N),l.setStyle("top",w+N),w+=d+n,b=Math.max(b,g.width);A+=b}this._contentRect={left:m,top:S,right:v,bottom:C},this.get("includeInChartLayout")&&this.set("width",A+r.right)},_setColumnArrays:function(t,e,i){for(var h,s=t[0],r=[[s]],a=1,n=0,o=t.length,g=s.height,l=[[g]];a<o;++a)g+i+(h=(s=t[a]).height)<=e?(g+=i+h,r[n].push(s)):(g=i+h,r[n]&&(n+=1),r[n]=[s]),l[n]=g;I.columnArray=r,I.totalHeightArray=l},getStartPoint:function(t,e,i,h){var s;switch(i){case y:s=h.top;break;case"middle":s=.5*(t-e);break;case _:s=t-e-h.bottom}return s}},i=z.Base.create("cartesianChartLegend",z.CartesianChart,[],{_redraw:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0,this._callLater=!1;var t,e,i,h,s,r,a,n,o,g,l,d,c,f=this.get("width"),u=this.get("height"),y=this._getLayoutBoxDimensions(),p=y.left,_=y.right,w=y.top,b=y.bottom,m=this.get("leftAxesCollection"),S=this.get("rightAxesCollection"),v=this.get("topAxesCollection"),C=this.get("bottomAxesCollection"),L=0,x="visible",k=this.get("graph"),A=this.get("allowContentOverflow"),B=this.get("legend"),I={};if(m)for(l=[],L=(t=m.length)-1;-1<L;--L)l.unshift(p),p+=m[L].get("width");if(S)for(g=[],L=0,L=(t=S.length)-1;-1<L;--L)_+=S[L].get("width"),g.unshift(f-_);if(v)for(d=[],L=(t=v.length)-1;-1<L;--L)d.unshift(w),w+=v[L].get("height");if(C)for(c=[],L=(t=C.length)-1;-1<L;--L)b+=C[L].get("height"),c.unshift(u-b);if(I.left=p,I.top=w,I.bottom=u-b,I.right=f-_,!A){if(i=this._getTopOverflow(m,S),h=this._getBottomOverflow(m,S),y=this._getLeftOverflow(C,v),A=this._getRightOverflow(C,v),0<(o=i-w)&&(I.top=i,d))for(L=0,t=d.length;L<t;++L)d[L]+=o;if(0<(o=h-b)&&(I.bottom=u-h,c))for(L=0,t=c.length;L<t;++L)c[L]-=o;if(0<(o=y-p)&&(I.left=y,l))for(L=0,t=l.length;L<t;++L)l[L]+=o;if(0<(o=A-_)&&(I.right=f-A,g))for(L=0,t=g.length;L<t;++L)g[L]-=o}if(s=I.right-I.left,r=I.bottom-I.top,a=I.left,n=I.top,B&&B.get("includeInChartLayout"))switch(B.get("position")){case"left":B.set("y",n),B.set("height",r);break;case"top":case"bottom":B.set("x",a),B.set("width",s);break;case"right":B.set("y",n),B.set("height",r)}if(v){for(t=v.length,L=0;L<t;L++)(e=v[L]).get("width")!==s&&e.set("width",s),e.get("boundingBox").setStyle("left",a+N),e.get("boundingBox").setStyle("top",d[L]+N);e._hasDataOverflow()&&(x="hidden")}if(C){for(t=C.length,L=0;L<t;L++)(e=C[L]).get("width")!==s&&e.set("width",s),e.get("boundingBox").setStyle("left",a+N),e.get("boundingBox").setStyle("top",c[L]+N);e._hasDataOverflow()&&(x="hidden")}if(m){for(t=m.length,L=0;L<t;++L)(e=m[L]).get("boundingBox").setStyle("top",n+N),e.get("boundingBox").setStyle("left",l[L]+N),e.get("height")!==r&&e.set("height",r);e._hasDataOverflow()&&(x="hidden")}if(S){for(t=S.length,L=0;L<t;++L)(e=S[L]).get("boundingBox").setStyle("top",n+N),e.get("boundingBox").setStyle("left",g[L]+N),e.get("height")!==r&&e.set("height",r);e._hasDataOverflow()&&(x="hidden")}this._drawing=!1,this._callLater?this._redraw():(k&&(k.get("boundingBox").setStyle("left",a+N),k.get("boundingBox").setStyle("top",n+N),k.set("width",s),k.set("height",r),k.get("boundingBox").setStyle("overflow",x)),this._overlay&&(this._overlay.setStyle("left",a+N),this._overlay.setStyle("top",n+N),this._overlay.setStyle("width",s+N),this._overlay.setStyle("height",r+N)))}},_getLayoutBoxDimensions:function(){var t,e,i,h,s={top:0,right:0,bottom:0,left:0},r=this.get("legend"),a=this.get(b),n=this.get(m);if(r&&r.get("includeInChartLayout")&&(h=r.get("styles").gap,"external"!==(t=r.get(d))))switch(e=r.get("direction"),i=r.get(e===o?m:b),s[t]=i+h,t){case y:r.set(v,0);break;case _:r.set(v,n-i);break;case p:r.set(S,a-i);break;case w:r.set(S,0)}return s},destructor:function(){var t=this.get("legend");t&&t.destroy(!0)}},{ATTRS:{legend:e}});z.CartesianChart=i,e=z.Base.create("pieChartLegend",z.PieChart,[],{_redraw:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0,this._callLater=!1;var t,e,i,h,s,r,a,n=this.get("graph"),o=this.get("width"),g=this.get("height"),l=this.get("legend"),d=0,c=0,f=0,u=0;if(n)if(l)if(l.get("position"),a=l.get("direction"),t=n.get("width"),e=n.get("height"),i=l.get("width"),h=l.get("height"),r=l.get("styles").gap,
"vertical"===a&&t+i+r!==o||"horizontal"===a&&e+h+r!==g){switch(l.get("position")){case w:s=Math.min(o-(i+r),g),d=i+r,l.set(m,h=g);break;case y:s=Math.min(g-(h+r),o),c=h+r,l.set(b,i=o);break;case p:f=(s=Math.min(o-(i+r),g))+r,l.set(m,h=g);break;case _:u=(s=Math.min(g-(h+r),o))+r,l.set(b,i=o)}n.set(b,s),n.set(m,s)}else switch(l.get("position")){case w:d=i+r;break;case y:c=h+r;break;case p:f=t+r;break;case _:u=e+r}else n.set(S,0),n.set(v,0),n.set(b,o),n.set(m,g);this._drawing=!1,this._callLater?this._redraw():(n&&(n.set(S,d),n.set(v,c)),l&&(l.set(S,f),l.set(v,u)))}}},{ATTRS:{legend:e}}),z.PieChart=e,z.ChartLegend=z.Base.create("chartlegend",z.Widget,[z.Renderer],{initializer:function(){this._items=[]},renderUI:function(){var t=this.get("boundingBox"),e=this.get("contentBox"),i=this.get("styles").background,i=new z.Rect({graphic:e,fill:i.fill,stroke:i.border});t.setStyle("display","block"),t.setStyle("position","absolute"),this.set("background",i)},bindUI:function(){this.get("chart").after("seriesCollectionChange",z.bind(this._updateHandler,this)),this.get("chart").after("stylesChange",z.bind(this._updateHandler,this)),this.after("stylesChange",this._updateHandler),this.after("positionChange",this._positionChangeHandler),this.after("widthChange",this._handleSizeChange),this.after("heightChange",this._handleSizeChange)},syncUI:function(){var t=this.get("width"),e=this.get("height");isFinite(t)&&isFinite(e)&&0<t&&0<e&&this._drawLegend()},_updateHandler:function(){this.get("rendered")&&this._drawLegend()},_positionChangeHandler:function(){var t=this.get("chart");this._parentNode&&t&&this.get("includeInChartLayout")?this.fire("legendRendered"):this.get("rendered")&&this._drawLegend()},_handleSizeChange:function(t){var e=t.attrName,t=this.get(d);(t!==_&&t!==y||e!==b)&&(t!==w&&t!==p||e!==m)||this._drawLegend()},_drawLegend:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0,this._callLater=!1,this.get("includeInChartLayout")&&this.get("chart")._itemRenderQueue.unshift(this);var t,e,i,h,s,r,a,n,o,g,l,d,c,f,u,y,p=this.get("chart"),_=this.get("contentBox"),w=p.get("seriesCollection"),b=this.get("styles"),m=b.padding,S=b.item,v=S.hSpacing,C=S.vSpacing,L=this.get("direction"),x="vertical"===L?b.vAlign:b.hAlign,k=b.marker,A=S.label,L=this._layout[L],B=[],I=k.width,N=k.height,M=0-v,R=0-C,D=0,O=0;if(k&&k.shape&&(a=k.shape),this._destroyLegendItems(),p instanceof z.PieChart)for(i=(t=w[0]).get("categoryAxis").getDataByKey(t.get("categoryKey")),d=(e=t.get("styles").marker).fill.colors,c=e.border.colors,f=e.border.weight,h=0,s=i.length,n=a||z.Circle,r=z.Lang.isArray(n);h<s;++h)n=r?n[h]:n,g={color:d[h]},l={colors:c[h],weight:f},i=p.getSeriesItems(t,h).category.value,u=(o=this._getLegendItem(_,this._getShapeClass(n),g,l,A,I,N,i)).width,y=o.height,D=Math.max(D,u),O=Math.max(O,y),M+=u+v,R+=y+C,B.push(o);else for(h=0,s=w.length;h<s;++h)t=w[h],e=this._getStylesBySeriesType(t,n),a||(n=(n=e.shape)||z.Circle),z.Lang.isArray(n)&&n[h],u=(o=this._getLegendItem(_,this._getShapeClass(n),e.fill,e.border,A,I,N,t.get("valueDisplayName"))).width,y=o.height,D=Math.max(D,u),O=Math.max(O,y),M+=u+v,R+=y+C,B.push(o);this._drawing=!1,this._callLater?this._drawLegend():(L._positionLegendItems.apply(this,[B,D,O,M,R,m,v,C,x]),this._updateBackground(b),this.fire("legendRendered"))}},_updateBackground:function(t){var e=t.background,i=this._contentRect,h=t.padding,s=i.left-h.left,r=i.top-h.top,t=i.right-s+h.right,h=i.bottom-r+h.bottom;this.get("background").set({fill:e.fill,stroke:e.border,width:t,height:h,x:s,y:r})},_getStylesBySeriesType:function(t){var e,i=t.get("styles");return t instanceof z.LineSeries||t instanceof z.StackedLineSeries?{border:{weight:1,color:e=(i=t.get("styles").line).color||t._getDefaultColor(t.get("graphOrder"),"line")},fill:{color:e}}:t instanceof z.AreaSeries||t instanceof z.StackedAreaSeries?{border:{weight:1,color:e=(i=t.get("styles").area).color||t._getDefaultColor(t.get("graphOrder"),"slice")},fill:{color:e}}:{fill:(i=t.get("styles").marker).fill,border:{weight:i.border.weight,color:i.border.color,shape:i.shape},shape:i.shape}},_getLegendItem:function(t,e,i,h,s,r,a,n){var o=z.Node.create("<div>"),g=z.Node.create("<span>"),l=e;return o.setStyle(d,"absolute"),g.setStyle(d,"absolute"),g.setStyles(s),g.set("text",n),o.appendChild(g),t.append(o),e=g.get("offsetHeight"),g.setStyle("left",(t=r+(s=e-a)+2)+N),o.setStyle("height",e+N),o.setStyle("width",t+g.get("offsetWidth")+N),l=new l({fill:i,stroke:h,width:r,height:a,x:.5*s,y:.5*s,w:r,h:a,graphic:o}),g.setStyle("left",e+N),n={node:o,width:o.get("offsetWidth"),height:o.get("offsetHeight"),shape:l,textNode:g,text:n},this._items.push(n),n},_getShapeClass:function(){var t=this.get("background").get("graphic");return t._getShapeClass.apply(t,arguments)},_getDefaultStyles:function(){return{padding:{top:8,right:8,bottom:8,left:9},gap:10,hAlign:"center",vAlign:"top",marker:this._getPlotDefaults(),item:{hSpacing:10,vSpacing:5,label:{color:"#808080",fontSize:"85%",whiteSpace:"nowrap"}},background:{shape:"rect",fill:{color:"#faf9f2"},border:{color:"#dad8c9",weight:1}}}},_getPlotDefaults:function(){return{width:10,height:10}},_destroyLegendItems:function(){var t;if(this._items)for(;0<this._items.length;)(t=this._items.shift()).shape.get("graphic").destroy(),t.node.empty(),t.node.destroy(!0),t.node=null,t=null;this._items=[]},_layout:{vertical:I,horizontal:B},destructor:function(){var t=this.get("background");this._destroyLegendItems(),t&&(t.get("graphic")||t).destroy()}},{ATTRS:{includeInChartLayout:{value:!1},chart:{setter:function(t){return this.after("legendRendered",z.bind(t._itemRendered,t)),t}},direction:{value:"vertical"},position:{lazyAdd:!1,value:"right",setter:function(t){return t===y||t===_?this.set("direction",o):t!==w&&t!==p||this.set("direction","vertical"),t}},width:{getter:function(){var t=this.get("chart"),e=this._parentNode;return e?t&&this.get("includeInChartLayout")||this._width?(this._width||(this._width=0),this._width):e.get("offsetWidth"
):""},setter:function(t){return this._width=t}},height:{valueFn:"_heightGetter",getter:function(){var t=this.get("chart"),e=this._parentNode;return e?t&&this.get("includeInChartLayout")||this._height?(this._height||(this._height=0),this._height):e.get("offsetHeight"):""},setter:function(t){return this._height=t}},x:{lazyAdd:!1,value:0,setter:function(t){var e=this.get("boundingBox");return e&&e.setStyle(w,t+N),t}},y:{lazyAdd:!1,value:0,setter:function(t){var e=this.get("boundingBox");return e&&e.setStyle(y,t+N),t}},items:{getter:function(){return this._items}},background:{}}})},"@VERSION@",{requires:["charts-base"]});
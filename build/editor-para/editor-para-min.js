YUI.add("editor-para",function(_,e){var t=function(){t.superclass.constructor.apply(this,arguments)},m="host",O="parentNode",C="p",A="<br>",x="firstChild";_.extend(t,_.Plugin.EditorParaBase,{_getRoot:function(){return this.get(m).getInstance().EditorSelection.ROOT},_onNodeChange:function(e){var t,o,a,n,r,c,i,d,s,l,g,h,p,f,N,u,E,v=this.get(m),S=v.getInstance(),b=S.EditorSelection.DEFAULT_BLOCK_TAG,k=":last-child",P=!1,T=this._getRoot();switch(e.changedType){case"enter-up":if(p=(h=this._lastPara||e.changedNode).one("br.yui-cursor"),this._lastPara&&delete this._lastPara,p&&(p.previous()||p.next())&&p.ancestor(C)&&p.remove(),h.test(b)||(p=h.ancestor(b))&&(h=p,0),h.test(b)&&(s=h.previous())){for(N=s.one(k);!P;)N&&(u=N.one(k))?N=u:P=!0;N&&v.copyStyles(N,h)}break;case"enter":if(_.UA.webkit&&e.changedEvent.shiftKey&&(v.execCommand("insertbr"),e.changedEvent.preventDefault()),e.changedNode.test("li")&&!_.UA.ie&&""===S.EditorSelection.getText(e.changedNode)&&(""!==(f=(o=e.changedNode.ancestor("ol,ul")).getAttribute("dir"))&&(f=' dir = "'+f+'"'),o=e.changedNode.ancestor(S.EditorSelection.BLOCKS),l=S.Node.create("<p"+f+">"+S.EditorSelection.CURSOR+"</p>"),o.insert(l,"after"),e.changedNode.remove(),e.changedEvent.halt(),(f=new S.EditorSelection).selectNode(l,!0,!1)),_.UA.gecko&&"p"!==v.get("defaultblock")&&!(o=e.changedNode).test("li")&&!o.ancestor("li")){if(o.test(b)||(o=o.ancestor(b)),l=S.Node.create("<"+b+"></"+b+">"),o.insert(l,"after"),(f=new S.EditorSelection).anchorOffset){for(o=f.anchorNode.get("textContent"),t=S.one(S.config.doc.createTextNode(o.substr(0,f.anchorOffset))),o=S.one(S.config.doc.createTextNode(o.substr(f.anchorOffset))),(n=f.anchorNode).setContent(""),(r=n.cloneNode()).append(o),c=!1,d=n;!c;)(d=d.get(O))&&!d.test(b)?((i=d.cloneNode()).set("innerHTML",""),i.append(r),a=d.get("childNodes"),E=!1,a.each(function(e){E&&i.append(e),e===n&&(E=!0)}),n=d,r=i):c=!0;o=r,f.anchorNode.append(t),o&&l.append(o)}(l=l.get(x)?l.get(x):l).prepend(S.EditorSelection.CURSOR),f.focusCursor(!0,!0),""!==S.EditorSelection.getText(l)&&S.EditorSelection.cleanCursor(),e.changedEvent.preventDefault()}break;case"keyup":_.UA.gecko&&T&&T.getHTML().length<20&&(T.one("> p")||this._fixFirstPara());break;case"backspace-up":case"backspace-down":case"delete-up":_.UA.ie||(f=T.all("> p"),l=T,(f=(l=f.item(0)?f.item(0):l).one("br"))&&(f.removeAttribute("id"),f.removeAttribute("class")),t=(t=S.EditorSelection.getText(l)).replace(/ /g,"").replace(/\n/g,""),f=l.all("img"),0!==t.length||f.size()||(l.test(C)||this._fixFirstPara(),g=null,(g=(g=!(g=e.changedNode&&e.changedNode.test(C)?e.changedNode:g)&&v._lastPara&&v._lastPara.inDoc()?v._lastPara:g)&&!g.test(C)?g.ancestor(C):g)&&!g.previous()&&g.get(O)&&g.get(O).compareTo(T)&&(e.changedEvent.frameEvent.halt(),e.preventDefault())),_.UA.webkit&&e.changedNode&&(e.preventDefault(),!(l=e.changedNode).test("li")||l.previous()||l.next()||""===l.get("innerHTML").replace(A,"")&&l.get(O)&&(l.get(O).replace(S.Node.create(A)),e.changedEvent.frameEvent.halt(),S.EditorSelection.filterBlocks()))),_.UA.gecko&&this._fixGeckoOnBackspace(S)}_.UA.gecko&&e.changedNode&&!e.changedNode.test(b)&&(g=e.changedNode.ancestor(b))&&(this._lastPara=g)},_fixGeckoOnBackspace:function(e){var t,o=new e.EditorSelection;o.isCollapsed&&"P"===o.anchorNode.get("nodeName")&&0!==o.anchorOffset&&(t=o.anchorNode.get("childNodes"),e=o.anchorNode.get("lastChild"),o.anchorOffset===t.size()&&"BR"===e.get("nodeName")&&(1!==o.anchorOffset?(e=e.get("previousSibling")).get("nodeType")===Node.TEXT_NODE&&(offset=e.get("length"),o.getEditorOffset()===offset&&o.selectNode(e,!0,offset)):o.selectNode(o.anchorNode,!0)))},initializer:function(){var e=this.get(m);e.editorBR?_.error("Can not plug EditorPara and EditorBR at the same time."):e.on("nodeChange",_.bind(this._onNodeChange,this))}},{NAME:"editorPara",NS:"editorPara",ATTRS:{host:{value:!1}}}),_.namespace("Plugin"),_.Plugin.EditorPara=t},"@VERSION@",{requires:["editor-para-base"]});